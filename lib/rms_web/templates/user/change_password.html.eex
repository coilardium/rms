<!DOCTYPE html>
<html lang="en">
    <head>
      <meta name="description" content="Login">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, minimal-ui">
      <!-- Call App Mode on ios devices -->
      <meta name="apple-mobile-web-app-capable" content="yes" />
      <!-- Remove Tap Highlight on Windows Phone IE -->
      <meta name="msapplication-tap-highlight" content="no">
      <meta charset="utf-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Change Password</title>
        <link rel="stylesheet" media="screen, print" href="<%= Routes.static_path(@conn, "/css/login/vendors.bundle.css") %>" />
        <link rel="stylesheet" media="screen, print" href="<%= Routes.static_path(@conn, "/css/login/default.css") %>" />
        <link rel="stylesheet" media="screen, print" href="<%= Routes.static_path(@conn, "/css/login/app.bundle.css") %>" />
		<link href="/vendors/vendors/line-awesome/css/line-awesome.css" rel="stylesheet" type="text/css" />
		<link rel="apple-touch-icon" sizes="180x180" href="<%= Routes.static_path(@conn, "/images/apple-touch-icon.png") %>">
		<link rel="icon" type="image/png" sizes="32x32"  href="<%= Routes.static_path(@conn, "/images/favicon-32x32.png") %>">
		<link rel="icon" type="image/png" sizes="16x16" href="<%= Routes.static_path(@conn, "/images/favicon-16x16.png") %>">
    </head>
    <body>

    <div class="page-wrapper">
            <div class="page-inner bg-brand-gradient">
                <div class="page-content-wrapper bg-transparent m-0" style="background-color: #282a3c;">
                    <div class="height-10 w-100 shadow-lg px-4 bg-brand-gradient" style="background-color: #282a3c;" >
                        <div class="d-flex align-items-center container p-0">
                            <div class="pull-left text-left"  style="height: 100%; vertical-aling: center; padding-top: 12px;">
								<a href="https://rms.com.zm/" target='_blank' class="page-logo-link press-scale-down d-flex align-items-center position-relative">
									<span> <img src="<%= Routes.static_path(@conn, "/images/Logo_mark.png") %>"  width="50px" height="50px" alt="probase_logo"></span>
								</a>
                            </div>
                            <a href="#" onclick="history.back(-1)" class="btn-link text-white ml-auto">
                                Go to Back
                            </a>
                        </div>
                    </div>
                    <div class="flex-1" style="background: url(/images/pattern-1.svg) no-repeat center bottom fixed; background-size: cover; background-color: #282a3c;">
                        <div class="container py-4 py-lg-5 my-lg-5 px-4 px-sm-0">
							<div class="row">
								<div class="col-xl-4 ml-auto mr-auto">
									<div class="card p-4 rounded-plus bg-faded" style="color: black;">
									<h4 style="text-align: center;">Change Password</h4><hr>
										<form href="<%= Routes.user_path(@conn, :change_password)%>" method="POST">
										<input type="hidden" name="_csrf_token" value="<%= Plug.CSRFProtection.get_csrf_token()%>">

											<div class="row">
												<div class="col-md-12 col-lg-offset-2">
													<div class="form-group">
														<%= if get_flash(@conn, :info) do %>
															<span class="text-danger fw-300"> Congrats...<%= get_flash(@conn, :info) %></span>
														<% end %>
														<%= if get_flash(@conn, :error) do %>
															<span class="text-danger fw-300"> Oops! <%= get_flash(@conn, :error) %></span>
														<% end %>
													</div>
												</div>
											</div><br>

											<div class="form-group">
                                                <label class="form-label" for="addon-wrapping-right">Current Password</label>
                                                <div class="input-group flex-nowrap">
                                                   	<input type="password" name="user[old_password]" id="password" placeholder="Enter old password" class="form-control" required="" >
                                                    <div class="input-group-append">
                                                        <span class="input-group-text"><i class="la la-eye-slash fs-xl" id="eye" ></i></span>
                                                    </div>
                                                </div>
                                            </div>

											<div class="form-group">
                                                <label class="form-label" for="addon-wrapping-right">New Password</label>
                                                <div class="input-group flex-nowrap">
                                                    <input type="password" placeholder="Enter new Password" minlength="8" name="user[new_password]" id="new_password" class="form-control" minlength="8"  class="form-control password" placeholder="New Password" required onfocus="document.getElementById('popover-password').style.display='block'" onblur="document.getElementById('popover-password').style.display='none'">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text"><i class="la la-eye-slash fs-xl" id="eye_2"></i></span>
                                                    </div>
                                                </div>
												<div id="popover-password" style="display: none;">
												<p style="font-size: 10px;">Password Strength: <span id="result"> </span></p>
												<div class="progress">
												<div id="new_password-strength" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:0%">
												</div>
												</div>
												<ul class="list-unstyled text-info" style="font-size: 8px;">
													<span class="low-upper-case"><i class="fa fa-times" aria-hidden="true"></i></span>&nbsp; 1 Lower & upper case
													<span class="one-number"><i class="fa fa-times" aria-hidden="true"></i></span> &nbsp;1 Number
													<span class="one-special-char"><i class="fa fa-times" aria-hidden="true"></i></span> &nbsp;1 Special Character
													<span class="eight-character"><i class="fa fa-times" aria-hidden="true"></i></span>&nbsp; 8 Characters
												</ul>
												</div>
                                            </div>

										  	<div class="form-group">
                                                <label class="form-label" for="addon-wrapping-right">Confirm New Password</label>
                                                <div class="input-group flex-nowrap">
                                                    <input type="password" placeholder="Confirm new password" minlength="8" name="user[new_password]" id="confirm_password" class="form-control" required="" onfocus="document.getElementById('divCheckPasswordMatch').style.display='block'" onblur="document.getElementById('divCheckPasswordMatch').style.display='none'">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text"><i class="la la-lock fs-xl"></i></span>
                                                    </div>
                                                </div>
												<div class="registrationFormAlert" id="divCheckPasswordMatch"></div>
                                            </div>
											<div class="row no-gutters">
												<div class="col-md-6 ml-auto text-right">
													<button type="submit" id="" class="btn btn-danger waves-effect waves-themed">Change</button>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
                        </div>
                        <div class="position-absolute pos-bottom pos-left pos-right p-3 text-center text-white">
							<%= Timex.today.year %> Â© Powered by&nbsp;<a href='http://www.probasegroup.com' class='text-white opacity-40 fw-500' title='probasegroup.com' target='_blank'>ProBase</a>
						</div>
                    </div>
                </div>
            </div>
        </div>

    <script src="<%= Routes.static_path(@conn, "/js/vendors.bundle.js") %>"></script>
    <script type="text/javascript" src="<%= Routes.static_path(@conn, "/js/app.js") %>"></script>
	<script>
        $(function(){
            $('#eye').click(function(){
                if($(this).hasClass('la-eye-slash')){

                    $(this).removeClass('la-eye-slash');

                    $(this).addClass('la-eye');

                    $('#password').attr('type','text');

                }else{

                    $(this).removeClass('la-eye');

                    $(this).addClass('la-eye-slash');

                    $('#password').attr('type','password');
                }
            });
        });

	    $(function(){
            $('#eye_2').click(function(){
                if($(this).hasClass('la-eye-slash')){

                    $(this).removeClass('la-eye-slash');

                    $(this).addClass('la-eye');

                    $('#new_password').attr('type','text');

					$('#confirm_password').attr('type','text');


                }else{

                    $(this).removeClass('la-eye');

                    $(this).addClass('la-eye-slash');

                    $('#new_password').attr('type','password');

					$('#confirm_password').attr('type','password');
                }
            });
        });
	</script>

	<script>
		$(document).ready(function() {
			$('#new_password').keyup(function() {
				var password = $('#new_password').val();
				if (checkStrength(password) == false) {
					$('#submit_password').attr('disabled', true);
				}
			});
			$('#confirm_password').blur(function() {
				if ($('#new_password').val() !== $('#confirm_password').val()) {
					$('#popover-cpassword').removeClass('hide');
					$('#submit_password').attr('disabled', true);
				} else {
					$('#popover-cpassword').addClass('hide');
				}
			});
			function checkStrength(password) {
				var strength = 0;
				//If password contains both lower and uppercase characters, increase strength value.
				if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)) {
					strength += 1;
					$('.low-upper-case').addClass('text-success');
					$('.low-upper-case i').removeClass('fa-times').addClass('fa-check');
					$('#popover-password-top').addClass('hide');

				} else {
					$('.low-upper-case').removeClass('text-success');
					$('.low-upper-case i').addClass('fa-times').removeClass('fa-check');
					$('#popover-password-top').removeClass('hide');
				}

				//If it has numbers and characters, increase strength value.
				if (password.match(/([a-zA-Z])/) && password.match(/([0-9])/)) {
					strength += 1;
					$('.one-number').addClass('text-success');
					$('.one-number i').removeClass('fa-times').addClass('fa-check');
					$('#popover-password-top').addClass('hide');

				} else {
					$('.one-number').removeClass('text-success');
					$('.one-number i').addClass('fa-times').removeClass('fa-check');
					$('#popover-password-top').removeClass('hide');
				}

				//If it has one special character, increase strength value.
				if (password.match(/([!,%,&,@,#,$,^,*,?,~])/)) {
					strength += 1;
					$('.one-special-char').addClass('text-success');
					$('.one-special-char i').removeClass('fa-times').addClass('fa-check');
					$('#popover-password-top').addClass('hide');

				} else {
					$('.one-special-char').removeClass('text-success');
					$('.one-special-char i').addClass('fa-times').removeClass('fa-check');
					$('#popover-password-top').removeClass('hide');
				}

				if (password.length > 7) {
					strength += 1;
					$('.eight-character').addClass('text-success');
					$('.eight-character i').removeClass('fa-times').addClass('fa-check');
					$('#popover-password-top').addClass('hide');

				} else {
					$('.eight-character').removeClass('text-success');
					$('.eight-character i').addClass('fa-times').removeClass('fa-check');
					$('#popover-password-top').removeClass('hide');
				}

				// If value is less than 2

				if (strength < 2) {
					$('#result').removeClass()
					$('#new_password-strength').addClass('progress-bar-danger');
					$('#result').text('Short').css('color', 'red')
					$('#new_password-strength').css('width', '10%');
				} else if (strength == 2) {
					$('#result').addClass('Weak');
					$('#new_password-strength').removeClass('progress-bar-danger');
					$('#new_password-strength').addClass('progress-bar-warning');
					$('#result').text('Weak').css('color', 'gold')
					$('#new_password-strength').css('width', '30%');
					return 'Weak'
				} else if (strength == 3) {
					$('#result').removeClass()
					$('#result').addClass('Fair');
					$('#new_password-strength').removeClass('progress-bar-warning');
					$('#new_password-strength').addClass('progress-bar-info');
					$('#result').text('Fair').css('color', 'skyblue')
					$('#new_password-strength').css('width', '70%');
					return 'Fair'
				} else if (strength == 4) {
					$('#result').removeClass()
					$('#result').addClass('strong');
					$('#new_password-strength').removeClass('progress-bar-info');
					$('#new_password-strength').addClass('progress-bar-success');
					$('#result').addClass('text-success').text('Strong');
					$('#new_password-strength').css('width', '100%');
					return 'Strong'
				}
			}
		});
		var password = document.getElementById("new_password"),
		confirm_password = document.getElementById("confirm_password");

		function validatePassword(){
		if(password.value != confirm_password.value) {
			confirm_password.setCustomValidity("Passwords Do not Match").addClass('text-danger');
		} else {
			confirm_password.setCustomValidity('');
		}
		}

		password.onchange = validatePassword;
		confirm_password.onkeyup = validatePassword;
	</script>

    </body>

</html>
